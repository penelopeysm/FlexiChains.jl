<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Usage with Turing.jl · FlexiChains.jl</title><meta name="title" content="Usage with Turing.jl · FlexiChains.jl"/><meta property="og:title" content="Usage with Turing.jl · FlexiChains.jl"/><meta property="twitter:title" content="Usage with Turing.jl · FlexiChains.jl"/><meta name="description" content="Documentation for FlexiChains.jl."/><meta property="og:description" content="Documentation for FlexiChains.jl."/><meta property="twitter:description" content="Documentation for FlexiChains.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">FlexiChains.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Overview</a></li><li class="is-active"><a class="tocitem" href>Usage with Turing.jl</a><ul class="internal"><li><a class="tocitem" href="#Sampling"><span>Sampling</span></a></li><li><a class="tocitem" href="#Key-types"><span>Key types</span></a></li><li><a class="tocitem" href="#Accessing-data"><span>Accessing data</span></a></li><li><a class="tocitem" href="#Summary-statistics"><span>Summary statistics</span></a></li><li><a class="tocitem" href="#Saving-and-resuming-MCMC-sampling-progress"><span>Saving and resuming MCMC sampling progress</span></a></li><li><a class="tocitem" href="#Posterior-predictions-and-friends"><span>Posterior predictions and friends</span></a></li><li><a class="tocitem" href="#Plotting"><span>Plotting</span></a></li></ul></li><li><a class="tocitem" href="../summarising/">Summarising</a></li><li><a class="tocitem" href="../indexing/">Indexing</a></li><li><a class="tocitem" href="../plotting/">Plotting</a></li><li><a class="tocitem" href="../integrations/">Integrations with other packages</a></li><li><a class="tocitem" href="../api/">Public API</a></li><li><a class="tocitem" href="../why/">Why FlexiChains?</a></li><li><a class="tocitem" href="../whynot/">Why not FlexiChains?</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Usage with Turing.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Usage with Turing.jl</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/penelopeysm/FlexiChains.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/penelopeysm/FlexiChains.jl/blob/main/docs/src/turing.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Usage-with-Turing.jl"><a class="docs-heading-anchor" href="#Usage-with-Turing.jl">Usage with Turing.jl</a><a id="Usage-with-Turing.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Usage-with-Turing.jl" title="Permalink"></a></h1><p>This page provides a fairly high-level overview of how to use FlexiChains with Turing.jl.</p><h2 id="Sampling"><a class="docs-heading-anchor" href="#Sampling">Sampling</a><a id="Sampling-1"></a><a class="docs-heading-anchor-permalink" href="#Sampling" title="Permalink"></a></h2><p>To obtain a <code>FlexiChain</code> from Turing.jl, you will need to specify a <code>chain_type</code> of <code>FlexiChains.VNChain</code> when performing MCMC sampling.</p><p>Let&#39;s use a non-trivial model so that we can illustrate some features of FlexiChains.</p><pre><code class="language-julia hljs">using Turing, FlexiChains

y = [28, 8, -3, 7, -1, 1, 18, 12]
sigma = [15, 10, 16, 11, 9, 11, 10, 18]
@model function eight_schools(y, sigma)
    mu ~ Normal(0, 5)
    tau ~ truncated(Cauchy(0, 5); lower=0)
    theta ~ MvNormal(fill(mu, length(y)), tau^2 * I)
    for i in eachindex(y)
        y[i] ~ Normal(theta[i], sigma[i])
    end
    return (mu=mu, tau=tau)
end
model = eight_schools(y, sigma)
chain = sample(model, NUTS(), 5; chain_type=VNChain)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr1">FlexiChain (5 iterations, 1 chain)</span>
<span class="sgr38_5" style="color:#ff875f">↓ iter=3:7</span> | <span class="sgr38_5" style="color:#0087d7">→ chain=1:1</span>

<span class="sgr1">Parameter type   </span>VarName
<span class="sgr1">Parameters       </span>mu, tau, theta
<span class="sgr1">Extra keys       </span>:n_steps, :is_accept, :acceptance_rate, :log_density, :hamiltonian_energy, :hamiltonian_energy_error, :max_hamiltonian_energy_error, :tree_depth, :numerical_error, :step_size, :nom_step_size, :logprior, :loglikelihood, :logjoint
</code></pre><div class="admonition is-info" id="Note-c58b79a61802d46a"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-c58b79a61802d46a" title="Permalink"></a></header><div class="admonition-body"><p>We only run 5 MCMC iterations here to keep the output in the following sections small.</p></div></div><h2 id="Key-types"><a class="docs-heading-anchor" href="#Key-types">Key types</a><a id="Key-types-1"></a><a class="docs-heading-anchor-permalink" href="#Key-types" title="Permalink"></a></h2><p>First, notice in the printout above that a <code>FlexiChain</code> stores &#39;parameters&#39; and &#39;extra keys&#39; separately. Parameters correspond to random variables of the model you sampled from, whereas other keys are extra data associated with the samples drawn (for example, the log-joint probability of each sample).</p><p>In FlexiChains, these are wrapped in the <a href="../api/#FlexiChains.Parameter"><code>FlexiChains.Parameter</code></a> and <a href="../api/#FlexiChains.Extra"><code>FlexiChains.Extra</code></a> types respectively. Thus, the parameter <code>mu</code> is really stored as <code>Parameter(@varname(mu))</code>, and the log-joint probability is <code>Extra(:logjoint)</code>.</p><p>For a <code>FlexiChain{T}</code>, all <code>Parameter</code> keys must wrap objects that subtype <code>T</code>. <code>Extra</code>s on the other hand can wrap anything.</p><h2 id="Accessing-data"><a class="docs-heading-anchor" href="#Accessing-data">Accessing data</a><a id="Accessing-data-1"></a><a class="docs-heading-anchor-permalink" href="#Accessing-data" title="Permalink"></a></h2><p>FlexiChains provides multiple different ways to access the data for a given key.</p><h3 id="Parameters"><a class="docs-heading-anchor" href="#Parameters">Parameters</a><a id="Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Parameters" title="Permalink"></a></h3><p>To access parameters, the recommended way is to use <code>VarName</code>s to index into the chain. <code>VarName</code> is a data structure <a href="https://turinglang.org/AbstractPPL.jl/stable/api/#AbstractPPL.VarName">defined in AbstractPPL.jl</a>, and is what Turing.jl uses to represent the name of a random variable (appearing on the left-hand side of a tilde-statement).</p><p><code>VarName</code>s are most easily constructed by applying the <code>@varname</code> macro to the name of the variable that you want to access. For example, this directly gives us the value of <code>mu</code> in each iteration as a plain old vector of floats.</p><pre><code class="language-julia hljs">chain[@varname(mu)]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr90">┌ </span><span class="sgr38_5" style="color:#ff875f">5</span>×<span class="sgr38_5" style="color:#0087d7">1</span> DimArray{Float64, 2}<span class="sgr90"> ┐</span>
<span class="sgr90">├──────────────────────────┴────────────────────────── dims ┐</span>
  <span class="sgr38_5" style="color:#ff875f">↓ iter</span> Sampled{Int64} <span class="sgr38_5" style="color:#ff875f">3:7</span> <span class="sgr38_5" style="color:#808080">ForwardOrdered</span> <span class="sgr38_5" style="color:#808080">Regular</span> <span class="sgr38_5" style="color:#808080">Points</span>,
  <span class="sgr38_5" style="color:#0087d7">→ chain</span> Sampled{Int64} <span class="sgr38_5" style="color:#0087d7">1:1</span> <span class="sgr38_5" style="color:#808080">ForwardOrdered</span> <span class="sgr38_5" style="color:#808080">Regular</span> <span class="sgr38_5" style="color:#808080">Points</span>
<span class="sgr90">└───────────────────────────────────────────────────────────┘</span>
 <span class="sgr38_5" style="color:#ff875f">↓</span> <span class="sgr38_5" style="color:#0087d7">→</span>   <span class="sgr38_5" style="color:#0087d7">1</span>
 <span class="sgr38_5" style="color:#ff875f">3</span>    -0.300767
 <span class="sgr38_5" style="color:#ff875f">4</span>     0.686116
 <span class="sgr38_5" style="color:#ff875f">5</span>     0.90019
 <span class="sgr38_5" style="color:#ff875f">6</span>    -0.0675814
 <span class="sgr38_5" style="color:#ff875f">7</span>    -0.84038</code></pre><div class="admonition is-info" id="Wrapping-in-Parameter-and-Extra-64cdd948f6f1b09a"><header class="admonition-header">Wrapping in Parameter and Extra<a class="admonition-anchor" href="#Wrapping-in-Parameter-and-Extra-64cdd948f6f1b09a" title="Permalink"></a></header><div class="admonition-body"><p>When looking up a parameter, you do not need to wrap the <code>VarName</code> in <code>FlexiChains.Parameter(...)</code>: this will be automatically done for you. But <code>Extra</code> keys always need to be wrapped.</p></div></div><div class="admonition is-info" id="DimMatrix-a3cf30e7f02daab7"><header class="admonition-header">DimMatrix<a class="admonition-anchor" href="#DimMatrix-a3cf30e7f02daab7" title="Permalink"></a></header><div class="admonition-body"><p>Indexing into a <code>FlexiChain</code> returns a <a href="https://rafaqz.github.io/DimensionalData.jl/stable/dimarrays#DimArrays"><code>DimensionalData.DimMatrix</code></a>. This behaves exactly like a regular <code>Matrix</code>, but additionally carries extra information about its dimensions.</p><p>This allows you to keep track of what each dimension means, and also allows for more advanced indexing operations, which are described in <a href="../indexing/">the &#39;indexing&#39; page</a>.</p></div></div><p>For vector-valued parameters like <code>theta</code>, this works in exactly the same way, except that you get a <code>DimMatrix</code> of vectors.</p><pre><code class="language-julia hljs">chain[@varname(theta)]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr90">┌ </span><span class="sgr38_5" style="color:#ff875f">5</span>×<span class="sgr38_5" style="color:#0087d7">1</span> DimArray{Vector{Float64}, 2}<span class="sgr90"> ┐</span>
<span class="sgr90">├──────────────────────────────────┴────────────────── dims ┐</span>
  <span class="sgr38_5" style="color:#ff875f">↓ iter</span> Sampled{Int64} <span class="sgr38_5" style="color:#ff875f">3:7</span> <span class="sgr38_5" style="color:#808080">ForwardOrdered</span> <span class="sgr38_5" style="color:#808080">Regular</span> <span class="sgr38_5" style="color:#808080">Points</span>,
  <span class="sgr38_5" style="color:#0087d7">→ chain</span> Sampled{Int64} <span class="sgr38_5" style="color:#0087d7">1:1</span> <span class="sgr38_5" style="color:#808080">ForwardOrdered</span> <span class="sgr38_5" style="color:#808080">Regular</span> <span class="sgr38_5" style="color:#808080">Points</span>
<span class="sgr90">└───────────────────────────────────────────────────────────┘</span>
 <span class="sgr38_5" style="color:#ff875f">↓</span> <span class="sgr38_5" style="color:#0087d7">→</span>  …  <span class="sgr38_5" style="color:#0087d7">1</span>
 <span class="sgr38_5" style="color:#ff875f">3</span>        [-0.573745, -1.27662, 3.25416, -1.56911, -0.206349, -0.488008, -1.84229, -0.342981]
 <span class="sgr38_5" style="color:#ff875f">4</span>        [1.30697, 2.46618, -3.13757, 1.63557, 1.90048, 1.70376, 2.93656, -0.0161008]
 <span class="sgr38_5" style="color:#ff875f">5</span>        [2.08218, 1.12537, -2.68758, 1.88878, 1.45144, -0.531885, 0.653467, 0.689792]
 <span class="sgr38_5" style="color:#ff875f">6</span>        [-1.40984, -2.84433, 4.08659, -2.38886, 0.325061, 4.72296, 0.592839, -3.02102]
 <span class="sgr38_5" style="color:#ff875f">7</span>    …   [3.34274, -1.96858, -1.35722, 0.432016, -1.10819, 0.794123, 0.199835, 1.15246]</code></pre><p>Note that the samples are stored <em>not</em> as a 3D array, but rather a matrix of vectors.</p><div class="admonition is-success" id="I-really-wanted-it-as-a-3D-array...-751ee8a8dab6aa83"><header class="admonition-header">I really wanted it as a 3D array...<a class="admonition-anchor" href="#I-really-wanted-it-as-a-3D-array...-751ee8a8dab6aa83" title="Permalink"></a></header><div class="admonition-body"><p>You can use <code>stack(chain[@varname(theta)])</code> to get an 8 × 5 × 1 array (8 elements of <code>theta</code>, 5 iterations, 1 chain), and also <code>permutedims</code> if you&#39;d rather swap the order of the dimensions.</p></div></div><p>In any case, <strong>this is probably the biggest difference between FlexiChains and MCMCChains.</strong> MCMCChains by default will break vector-valued parameters into multiple scalar-valued parameters called <code>theta[1]</code>, <code>theta[2]</code>, etc., whereas FlexiChains keeps them together as they were defined in the model.</p><p>If you want to obtain only the first element of <code>theta</code>, you don&#39;t need to manipulate the <code>DimMatrix</code>. You can just index into the chain with the corresponding <code>VarName</code>:</p><pre><code class="language-julia hljs">chain[@varname(theta[1])]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr90">┌ </span><span class="sgr38_5" style="color:#ff875f">5</span>×<span class="sgr38_5" style="color:#0087d7">1</span> DimArray{Float64, 2}<span class="sgr90"> ┐</span>
<span class="sgr90">├──────────────────────────┴────────────────────────── dims ┐</span>
  <span class="sgr38_5" style="color:#ff875f">↓ iter</span> Sampled{Int64} <span class="sgr38_5" style="color:#ff875f">3:7</span> <span class="sgr38_5" style="color:#808080">ForwardOrdered</span> <span class="sgr38_5" style="color:#808080">Regular</span> <span class="sgr38_5" style="color:#808080">Points</span>,
  <span class="sgr38_5" style="color:#0087d7">→ chain</span> Sampled{Int64} <span class="sgr38_5" style="color:#0087d7">1:1</span> <span class="sgr38_5" style="color:#808080">ForwardOrdered</span> <span class="sgr38_5" style="color:#808080">Regular</span> <span class="sgr38_5" style="color:#808080">Points</span>
<span class="sgr90">└───────────────────────────────────────────────────────────┘</span>
 <span class="sgr38_5" style="color:#ff875f">↓</span> <span class="sgr38_5" style="color:#0087d7">→</span>   <span class="sgr38_5" style="color:#0087d7">1</span>
 <span class="sgr38_5" style="color:#ff875f">3</span>    -0.573745
 <span class="sgr38_5" style="color:#ff875f">4</span>     1.30697
 <span class="sgr38_5" style="color:#ff875f">5</span>     2.08218
 <span class="sgr38_5" style="color:#ff875f">6</span>    -1.40984
 <span class="sgr38_5" style="color:#ff875f">7</span>     3.34274</code></pre><p>In this way, you can &#39;break down&#39;, or access nested fields of, larger parameters. That is, if your model has <code>x ~ dist</code>, FlexiChains will let you access some field or index of <code>x</code>.</p><div class="admonition is-info" id="Heterogeneous-data-9fbc1897755b61ce"><header class="admonition-header">Heterogeneous data<a class="admonition-anchor" href="#Heterogeneous-data-9fbc1897755b61ce" title="Permalink"></a></header><div class="admonition-body"><p>If some samples of <code>x</code> have one element and others have two elements, attempting to access <code>x[2]</code> will return an array with <code>missing</code> values for the samples where <code>x</code> only has one element.</p></div></div><div class="admonition is-info" id="Sub-variables-a6d34d5e26044e45"><header class="admonition-header">Sub-variables<a class="admonition-anchor" href="#Sub-variables-a6d34d5e26044e45" title="Permalink"></a></header><div class="admonition-body"><p>You can access <em>sub-variables</em> of a model parameter, but not the other way around. If your model looks like</p><pre><code class="language-julia hljs">@model function f()
    x[1] ~ dist
    return x[2] ~ dist
end</code></pre><p>or alternatively</p><pre><code class="language-julia hljs">@model function f()
    x = Vector{Float64}(undef, 2)
    return x .~ dist
end</code></pre><p>you cannot &#39;reconstruct&#39; <code>x</code> from its component elements, because <code>x</code> does not exist as a single parameter in the model. (Or at least, you can&#39;t do it with FlexiChains. You can still call <code>chain[@varname(x[1])]</code> and <code>chain[@varname(x[2])]</code> and then perform <code>hcat</code> or similar to put them together yourself.)</p></div></div><p>You can also use keyword arguments when indexing to specify which chains or iterations you are interested in. Note that when using square brackets to index, keyword arguments must be separated from positional arguments by a comma, not a semicolon!</p><pre><code class="language-julia hljs">chain[@varname(mu), iter=2:4, chain=1]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr90">┌ </span><span class="sgr38_5" style="color:#ff875f">3-element </span>DimArray{Float64, 1}<span class="sgr90"> ┐</span>
<span class="sgr90">├────────────────────────────────┴──────────────────── dims ┐</span>
  <span class="sgr38_5" style="color:#ff875f">↓ iter</span> Sampled{Int64} <span class="sgr38_5" style="color:#ff875f">4:6</span> <span class="sgr38_5" style="color:#808080">ForwardOrdered</span> <span class="sgr38_5" style="color:#808080">Regular</span> <span class="sgr38_5" style="color:#808080">Points</span>
<span class="sgr90">└───────────────────────────────────────────────────────────┘</span>
 <span class="sgr38_5" style="color:#ff875f">4</span>   0.686116
 <span class="sgr38_5" style="color:#ff875f">5</span>   0.90019
 <span class="sgr38_5" style="color:#ff875f">6</span>  -0.0675814</code></pre><p>The indexing behaviour of FlexiChains is described fully on <a href="../indexing/">the Indexing page</a>.</p><h3 id="Other-keys"><a class="docs-heading-anchor" href="#Other-keys">Other keys</a><a id="Other-keys-1"></a><a class="docs-heading-anchor-permalink" href="#Other-keys" title="Permalink"></a></h3><p>In general Turing.jl tries to package up some extra metadata into the chain that may be helpful. For example, the log-joint probability of each sample is stored with the key <code>:logjoint</code>. To access non-parameter information like this in an unambiguous fashion, you should use the <code>Extra</code> wrapper.</p><pre><code class="language-julia hljs">using FlexiChains: Extra

chain[Extra(:logjoint)]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr90">┌ </span><span class="sgr38_5" style="color:#ff875f">5</span>×<span class="sgr38_5" style="color:#0087d7">1</span> DimArray{Float64, 2}<span class="sgr90"> ┐</span>
<span class="sgr90">├──────────────────────────┴────────────────────────── dims ┐</span>
  <span class="sgr38_5" style="color:#ff875f">↓ iter</span> Sampled{Int64} <span class="sgr38_5" style="color:#ff875f">3:7</span> <span class="sgr38_5" style="color:#808080">ForwardOrdered</span> <span class="sgr38_5" style="color:#808080">Regular</span> <span class="sgr38_5" style="color:#808080">Points</span>,
  <span class="sgr38_5" style="color:#0087d7">→ chain</span> Sampled{Int64} <span class="sgr38_5" style="color:#0087d7">1:1</span> <span class="sgr38_5" style="color:#808080">ForwardOrdered</span> <span class="sgr38_5" style="color:#808080">Regular</span> <span class="sgr38_5" style="color:#808080">Points</span>
<span class="sgr90">└───────────────────────────────────────────────────────────┘</span>
 <span class="sgr38_5" style="color:#ff875f">↓</span> <span class="sgr38_5" style="color:#0087d7">→</span>    <span class="sgr38_5" style="color:#0087d7">1</span>
 <span class="sgr38_5" style="color:#ff875f">3</span>    -52.106
 <span class="sgr38_5" style="color:#ff875f">4</span>    -51.6048
 <span class="sgr38_5" style="color:#ff875f">5</span>    -50.2312
 <span class="sgr38_5" style="color:#ff875f">6</span>    -56.8202
 <span class="sgr38_5" style="color:#ff875f">7</span>    -53.3537</code></pre><div class="admonition is-warning" id="Warning-aef36dd091efee88"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-aef36dd091efee88" title="Permalink"></a></header><div class="admonition-body"><p>MCMCChains stores the log-joint probability as <code>:lp</code>. FlexiChains uses <code>:logjoint</code> instead, which is clearer. It is possible that MCMCChains may be changed to use <code>:logjoint</code> in the future, but for now this is another difference to be aware of.</p></div></div><p>If there is no ambiguity in the symbol <code>:logjoint</code>, then you can use a shortcut which is described in the next section.</p><h3 id="Indexing-by-Symbol:-a-shortcut"><a class="docs-heading-anchor" href="#Indexing-by-Symbol:-a-shortcut">Indexing by <code>Symbol</code>: a shortcut</a><a id="Indexing-by-Symbol:-a-shortcut-1"></a><a class="docs-heading-anchor-permalink" href="#Indexing-by-Symbol:-a-shortcut" title="Permalink"></a></h3><p>If you are used to MCMCChains.jl, you may find this more cumbersome than before. So, FlexiChains provides some shortcuts for accessing data. You can index into a <code>FlexiChain</code> with a single <code>Symbol</code>, and <em>as long as it is unambiguous</em>, it will return the corresponding data.</p><pre><code class="language-julia hljs">chain[:mu] # parameter</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr90">┌ </span><span class="sgr38_5" style="color:#ff875f">5</span>×<span class="sgr38_5" style="color:#0087d7">1</span> DimArray{Float64, 2}<span class="sgr90"> ┐</span>
<span class="sgr90">├──────────────────────────┴────────────────────────── dims ┐</span>
  <span class="sgr38_5" style="color:#ff875f">↓ iter</span> Sampled{Int64} <span class="sgr38_5" style="color:#ff875f">3:7</span> <span class="sgr38_5" style="color:#808080">ForwardOrdered</span> <span class="sgr38_5" style="color:#808080">Regular</span> <span class="sgr38_5" style="color:#808080">Points</span>,
  <span class="sgr38_5" style="color:#0087d7">→ chain</span> Sampled{Int64} <span class="sgr38_5" style="color:#0087d7">1:1</span> <span class="sgr38_5" style="color:#808080">ForwardOrdered</span> <span class="sgr38_5" style="color:#808080">Regular</span> <span class="sgr38_5" style="color:#808080">Points</span>
<span class="sgr90">└───────────────────────────────────────────────────────────┘</span>
 <span class="sgr38_5" style="color:#ff875f">↓</span> <span class="sgr38_5" style="color:#0087d7">→</span>   <span class="sgr38_5" style="color:#0087d7">1</span>
 <span class="sgr38_5" style="color:#ff875f">3</span>    -0.300767
 <span class="sgr38_5" style="color:#ff875f">4</span>     0.686116
 <span class="sgr38_5" style="color:#ff875f">5</span>     0.90019
 <span class="sgr38_5" style="color:#ff875f">6</span>    -0.0675814
 <span class="sgr38_5" style="color:#ff875f">7</span>    -0.84038</code></pre><div class="admonition is-info" id="What-does-unambiguous-mean?-e42f8ce76873ba5b"><header class="admonition-header">What does unambiguous mean?<a class="admonition-anchor" href="#What-does-unambiguous-mean?-e42f8ce76873ba5b" title="Permalink"></a></header><div class="admonition-body"><p>In this case, because the only key <code>k</code> for which <code>Symbol(k.name) == :mu</code> is <code>Parameter(@varname(mu))</code>, we can safely identify <code>Parameter(@varname(mu))</code> as the key that we want. If this chain also had an extra key called <code>Extra(:mu)</code>, then this would be ambiguous, and FlexiChains would throw an error.</p></div></div><div class="admonition is-info" id="No-sub-varnames-c069dc46d0969a97"><header class="admonition-header">No sub-varnames<a class="admonition-anchor" href="#No-sub-varnames-c069dc46d0969a97" title="Permalink"></a></header><div class="admonition-body"><p>You cannot use <code>chain[Symbol(&quot;theta[1]&quot;)]</code> as a replacement for <code>chain[@varname(theta[1])]</code>.</p></div></div><p>Likewise, we can omit wrapping <code>:logjoint</code> in <code>Extra(...)</code>:</p><pre><code class="language-julia hljs">chain[:logjoint] # other key</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr90">┌ </span><span class="sgr38_5" style="color:#ff875f">5</span>×<span class="sgr38_5" style="color:#0087d7">1</span> DimArray{Float64, 2}<span class="sgr90"> ┐</span>
<span class="sgr90">├──────────────────────────┴────────────────────────── dims ┐</span>
  <span class="sgr38_5" style="color:#ff875f">↓ iter</span> Sampled{Int64} <span class="sgr38_5" style="color:#ff875f">3:7</span> <span class="sgr38_5" style="color:#808080">ForwardOrdered</span> <span class="sgr38_5" style="color:#808080">Regular</span> <span class="sgr38_5" style="color:#808080">Points</span>,
  <span class="sgr38_5" style="color:#0087d7">→ chain</span> Sampled{Int64} <span class="sgr38_5" style="color:#0087d7">1:1</span> <span class="sgr38_5" style="color:#808080">ForwardOrdered</span> <span class="sgr38_5" style="color:#808080">Regular</span> <span class="sgr38_5" style="color:#808080">Points</span>
<span class="sgr90">└───────────────────────────────────────────────────────────┘</span>
 <span class="sgr38_5" style="color:#ff875f">↓</span> <span class="sgr38_5" style="color:#0087d7">→</span>    <span class="sgr38_5" style="color:#0087d7">1</span>
 <span class="sgr38_5" style="color:#ff875f">3</span>    -52.106
 <span class="sgr38_5" style="color:#ff875f">4</span>    -51.6048
 <span class="sgr38_5" style="color:#ff875f">5</span>    -50.2312
 <span class="sgr38_5" style="color:#ff875f">6</span>    -56.8202
 <span class="sgr38_5" style="color:#ff875f">7</span>    -53.3537</code></pre><h2 id="Summary-statistics"><a class="docs-heading-anchor" href="#Summary-statistics">Summary statistics</a><a id="Summary-statistics-1"></a><a class="docs-heading-anchor-permalink" href="#Summary-statistics" title="Permalink"></a></h2><h3 id="Overall-summaries"><a class="docs-heading-anchor" href="#Overall-summaries">Overall summaries</a><a id="Overall-summaries-1"></a><a class="docs-heading-anchor-permalink" href="#Overall-summaries" title="Permalink"></a></h3><p>For a very quick summary of the chain, you can use <code>StatsBase.summarystats</code> (which FlexiChains reexports):</p><pre><code class="language-julia hljs">using FlexiChains: summarystats

summarystats(chain)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr1">FlexiSummary (9 statistics)</span>
<span class="sgr38_5" style="color:#ff875f">↓ stat=[mean, std, mcse, ess_bulk, ess_tail, rhat, q5, q50, q95]</span>

<span class="sgr1">Parameter type   </span>VarName
<span class="sgr1">Parameters       </span>mu, tau, theta[1], theta[2], theta[3], theta[4], theta[5], theta[6], theta[7], theta[8]
<span class="sgr1">Extra keys       </span>n_steps, is_accept, acceptance_rate, log_density, hamiltonian_energy, hamiltonian_energy_error, max_hamiltonian_energy_error, tree_depth, numerical_error, step_size, nom_step_size, logprior, loglikelihood, logjoint

<span class="sgr1">     param     mean     std  mcse  ess_bulk  ess_tail    rhat       q5      q50     q95</span>
<span class="sgr1">        mu</span>   0.0755  0.7166   NaN       NaN       NaN  0.8901  -0.7325  -0.0676  0.8574
<span class="sgr1">       tau</span>   1.8719  0.6705   NaN       NaN       NaN  0.8159   1.3348   1.6788  2.7706
<span class="sgr1">  theta[1]</span>   0.9497  1.9381   NaN       NaN       NaN  1.6421  -1.2426   1.3070  3.0906
<span class="sgr1">  theta[2]</span>  -0.4996  2.2190   NaN       NaN       NaN  1.6421  -2.6692  -1.2766  2.1980
<span class="sgr1">  theta[3]</span>   0.0317  3.3983   NaN       NaN       NaN  0.9552  -3.0476  -1.3572  3.9201
<span class="sgr1">  theta[4]</span>  -0.0003  1.9104   NaN       NaN       NaN  0.8901  -2.2249   0.4320  1.8381
<span class="sgr1">  theta[5]</span>   0.4725  1.2226   NaN       NaN       NaN  0.9552  -0.9278   0.3251  1.8107
<span class="sgr1">  theta[6]</span>   1.2402  2.1605   NaN       NaN       NaN  0.8901  -0.5231   0.7941  4.1191
<span class="sgr1">  theta[7]</span>   0.5081  1.6989   NaN       NaN       NaN  1.6421  -1.4339   0.5928  2.4799
<span class="sgr1">  theta[8]</span>  -0.3076  1.6260   NaN       NaN       NaN  2.5566  -2.4854  -0.0161  1.0599</code></pre><div class="admonition is-info" id="Note-9b83ae3e4a94b522"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-9b83ae3e4a94b522" title="Permalink"></a></header><div class="admonition-body"><p>The large number of NaN&#39;s and Inf&#39;s here are just because of the very short chain length. On a real chain you would get proper statistics.</p></div></div><p>By default, <code>summarystats</code> will split <code>VarName</code>s up. This is done because summary statistics often only make sense for scalar-valued parameters, and users are unlikely to use a <code>FlexiSummary</code> to a performance-critical task. If you want to avoid this, you can set <code>split_varnames=false</code>:</p><pre><code class="language-julia hljs">summarystats(chain; split_varnames=false)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr1">FlexiSummary (9 statistics)</span>
<span class="sgr38_5" style="color:#ff875f">↓ stat=[mean, std, mcse, ess_bulk, ess_tail, rhat, q5, q50, q95]</span>

<span class="sgr1">Parameter type   </span>VarName
<span class="sgr1">Parameters       </span>mu, tau, theta
<span class="sgr1">Extra keys       </span>n_steps, is_accept, acceptance_rate, log_density, hamiltonian_energy, hamiltonian_energy_error, max_hamiltonian_energy_error, tree_depth, numerical_error, step_size, nom_step_size, logprior, loglikelihood, logjoint

<span class="sgr1">  param          mean           std     mcse  ess_bulk  ess_tail     rhat       q5      q50      q95</span>
<span class="sgr1">     mu</span>        0.0755        0.7166      NaN       NaN       NaN   0.8901  -0.7325  -0.0676   0.8574
<span class="sgr1">    tau</span>        1.8719        0.6705      NaN       NaN       NaN   0.8159   1.3348   1.6788   2.7706
<span class="sgr1">  theta</span>  [0.9,-0.5,0…  [1.9,2.2,3.…  missing   missing   missing  missing  missing  missing  missing</code></pre><p>Notice how many of the statistics for <code>theta</code> are now <code>missing</code>. This is because statistics like the quantiles cannot be meaningfully calculated for vector-valued parameters.</p><h3 id="Individual-summaries"><a class="docs-heading-anchor" href="#Individual-summaries">Individual summaries</a><a id="Individual-summaries-1"></a><a class="docs-heading-anchor-permalink" href="#Individual-summaries" title="Permalink"></a></h3><p>You can obtain, for example, the mean of each key in the chain using <code>Statistics.mean</code>. This returns a <code>FlexiSummary</code> object:</p><pre><code class="language-julia hljs">using Statistics: mean

mn = mean(chain)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr1">FlexiSummary</span>


<span class="sgr1">Parameter type   </span>VarName
<span class="sgr1">Parameters       </span>mu, tau, theta[1], theta[2], theta[3], theta[4], theta[5], theta[6], theta[7], theta[8]
<span class="sgr1">Extra keys       </span>n_steps, is_accept, acceptance_rate, log_density, hamiltonian_energy, hamiltonian_energy_error, max_hamiltonian_energy_error, tree_depth, numerical_error, step_size, nom_step_size, logprior, loglikelihood, logjoint

<span class="sgr1">     param         </span>
<span class="sgr1">        mu</span>   0.0755
<span class="sgr1">       tau</span>   1.8719
<span class="sgr1">  theta[1]</span>   0.9497
<span class="sgr1">  theta[2]</span>  -0.4996
<span class="sgr1">  theta[3]</span>   0.0317
<span class="sgr1">  theta[4]</span>  -0.0003
<span class="sgr1">  theta[5]</span>   0.4725
<span class="sgr1">  theta[6]</span>   1.2402
<span class="sgr1">  theta[7]</span>   0.5081
<span class="sgr1">  theta[8]</span>  -0.3076</code></pre><p>You can index into a <code>FlexiSummary</code> in exactly the same ways as a <code>FlexiChain</code>.</p><pre><code class="language-julia hljs">mn[@varname(mu)]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0.075515496460517</code></pre><p>Out of the box, FlexiChains provides many commonly used summary functions, such as <code>Statistics.mean</code> and <code>Statistics.std</code> (a full list is given in <a href="../summarising/">the Summarising page</a>). These functions can all be applied to a <code>FlexiChain</code> with their usual signatures (for example, <code>Statistics.quantile</code> will require a second argument). Keyword arguments of the original functions are also supported, for example <code>MCMCDiagnosticTools.ess(chain; kind=:tail)</code> returns the tail ESS.</p><div class="admonition is-info" id="Other-summary-functions-373e0a37b903bcd"><header class="admonition-header">Other summary functions<a class="admonition-anchor" href="#Other-summary-functions-373e0a37b903bcd" title="Permalink"></a></header><div class="admonition-body"><p>If you want to apply a summary function that isn&#39;t listed above, you can manually use <a href="../summarising/#FlexiChains.collapse"><code>FlexiChains.collapse</code></a>. If it is something that is worth appearing in FlexiChains proper, please do open an issue!</p></div></div><h3 id="Collapsed-dimensions"><a class="docs-heading-anchor" href="#Collapsed-dimensions">Collapsed dimensions</a><a id="Collapsed-dimensions-1"></a><a class="docs-heading-anchor-permalink" href="#Collapsed-dimensions" title="Permalink"></a></h3><p>By default, applying summary functions will collapse the data in both the iteration and chain dimensions (the latter is only relevant if multiple chains are present).</p><p>To only collapse over one dimension you can use</p><pre><code class="language-julia hljs">mean(chain; dims=:iter)[@varname(mu)]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr90">┌ </span><span class="sgr38_5" style="color:#ff875f">1-element </span>DimArray{Float64, 1}<span class="sgr90"> ┐</span>
<span class="sgr90">├────────────────────────────────┴───────────────────── dims ┐</span>
  <span class="sgr38_5" style="color:#ff875f">↓ chain</span> Sampled{Int64} <span class="sgr38_5" style="color:#ff875f">1:1</span> <span class="sgr38_5" style="color:#808080">ForwardOrdered</span> <span class="sgr38_5" style="color:#808080">Regular</span> <span class="sgr38_5" style="color:#808080">Points</span>
<span class="sgr90">└────────────────────────────────────────────────────────────┘</span>
 <span class="sgr38_5" style="color:#ff875f">1</span>  0.0755155</code></pre><p>or <code>dims=:chain</code> (although that is probably less useful).</p><h2 id="Saving-and-resuming-MCMC-sampling-progress"><a class="docs-heading-anchor" href="#Saving-and-resuming-MCMC-sampling-progress">Saving and resuming MCMC sampling progress</a><a id="Saving-and-resuming-MCMC-sampling-progress-1"></a><a class="docs-heading-anchor-permalink" href="#Saving-and-resuming-MCMC-sampling-progress" title="Permalink"></a></h2><p>If you want to sample a fewer number of iterations first and then resume it later, you can use the following:</p><pre><code class="language-julia hljs">chn1 = sample(model, NUTS(), 10;
    chain_type=VNChain, save_state=true
)
chn2 = sample(model, NUTS(), 10;
    chain_type=VNChain, initial_state=only(FlexiChains.last_sampler_state(chn1))
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr1">FlexiChain (10 iterations, 1 chain)</span>
<span class="sgr38_5" style="color:#ff875f">↓ iter=6:15</span> | <span class="sgr38_5" style="color:#0087d7">→ chain=1:1</span>

<span class="sgr1">Parameter type   </span>VarName
<span class="sgr1">Parameters       </span>mu, tau, theta
<span class="sgr1">Extra keys       </span>:n_steps, :is_accept, :acceptance_rate, :log_density, :hamiltonian_energy, :hamiltonian_energy_error, :max_hamiltonian_energy_error, :tree_depth, :numerical_error, :step_size, :nom_step_size, :logprior, :loglikelihood, :logjoint
</code></pre><p>The chains can be combined using <code>vcat</code>:</p><pre><code class="language-julia hljs">combined_chn = vcat(chn1, chn2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr1">FlexiChain (20 iterations, 1 chain)</span>
<span class="sgr38_5" style="color:#ff875f">↓ iter=[6 … 30]</span> | <span class="sgr38_5" style="color:#0087d7">→ chain=1:1</span>

<span class="sgr1">Parameter type   </span>VarName
<span class="sgr1">Parameters       </span>mu, tau, theta
<span class="sgr1">Extra keys       </span>:n_steps, :is_accept, :acceptance_rate, :log_density, :hamiltonian_energy, :hamiltonian_energy_error, :max_hamiltonian_energy_error, :tree_depth, :numerical_error, :step_size, :nom_step_size, :logprior, :loglikelihood, :logjoint
</code></pre><div class="admonition is-info" id="The-initial_state-argument-40de9b9f5e66dc1"><header class="admonition-header">The `initial_state` argument<a class="admonition-anchor" href="#The-initial_state-argument-40de9b9f5e66dc1" title="Permalink"></a></header><div class="admonition-body"><p>When performing <strong>single-chain sampling</strong> with <code>sample(model, spl, N; initial_state=state)</code>, <code>initial_state</code> should be either <code>nothing</code> (to start a new chain) or the state to resume from. For <strong>multiple-chain sampling</strong> with <code>sample(model, spl, MCMCThreads(), N, C)</code>, <code>initial_state</code> should be a vector of length <code>C</code>, where <code>initial_state[i]</code> is the state to resume the <code>i</code>-th chain from (or <code>nothing</code> to start a new chain).</p><p>To obtain the saved final state of a chain, you can use <a href="../api/#FlexiChains.last_sampler_state"><code>FlexiChains.last_sampler_state</code></a>. This always returns a vector of states with length equal to the number of chains. Note that this applies also if you only sampled a single chain, in which case the returned value is a vector of length 1: you will therefore have to use <code>only()</code> to extract the state itself.</p><p>The above applies equally to <code>MCMCSerial()</code> and <code>MCMCDistributed()</code>.</p></div></div><h2 id="Posterior-predictions-and-friends"><a class="docs-heading-anchor" href="#Posterior-predictions-and-friends">Posterior predictions and friends</a><a id="Posterior-predictions-and-friends-1"></a><a class="docs-heading-anchor-permalink" href="#Posterior-predictions-and-friends" title="Permalink"></a></h2><p>The functions <code>predict</code>, <code>returned</code>, <code>logjoint</code>, <code>loglikelihood</code>, and <code>logprior</code> all work &#39;as expected&#39; using FlexiChains with exactly the same signatures that you are used to.</p><pre><code class="language-julia hljs">returned(model, chain)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr90">┌ </span><span class="sgr38_5" style="color:#ff875f">5</span>×<span class="sgr38_5" style="color:#0087d7">1</span> DimArray{@NamedTuple{mu::Float64, tau::Float64}, 2}<span class="sgr90"> ┐</span>
<span class="sgr90">├─────────────────────────────────────────────────────────┴ dims ┐</span>
  <span class="sgr38_5" style="color:#ff875f">↓ iter</span> Sampled{Int64} <span class="sgr38_5" style="color:#ff875f">3:7</span> <span class="sgr38_5" style="color:#808080">ForwardOrdered</span> <span class="sgr38_5" style="color:#808080">Regular</span> <span class="sgr38_5" style="color:#808080">Points</span>,
  <span class="sgr38_5" style="color:#0087d7">→ chain</span> Sampled{Int64} <span class="sgr38_5" style="color:#0087d7">1:1</span> <span class="sgr38_5" style="color:#808080">ForwardOrdered</span> <span class="sgr38_5" style="color:#808080">Regular</span> <span class="sgr38_5" style="color:#808080">Points</span>
<span class="sgr90">└────────────────────────────────────────────────────────────────┘</span>
 <span class="sgr38_5" style="color:#ff875f">↓</span> <span class="sgr38_5" style="color:#0087d7">→</span>  <span class="sgr38_5" style="color:#0087d7">1</span>
 <span class="sgr38_5" style="color:#ff875f">3</span>     (mu = -0.300767, tau = 2.04898)
 <span class="sgr38_5" style="color:#ff875f">4</span>     (mu = 0.686116, tau = 1.67881)
 <span class="sgr38_5" style="color:#ff875f">5</span>     (mu = 0.90019, tau = 1.3311)
 <span class="sgr38_5" style="color:#ff875f">6</span>     (mu = -0.0675814, tau = 2.95095)
 <span class="sgr38_5" style="color:#ff875f">7</span>     (mu = -0.84038, tau = 1.34948)</code></pre><p><code>pointwise_logdensities</code>, <code>pointwise_loglikelihoods</code>, and <code>pointwise_prior_logdensities</code> are also supported, and will return a new FlexiChain containing the log-probabilities for each variable.</p><h2 id="Plotting"><a class="docs-heading-anchor" href="#Plotting">Plotting</a><a id="Plotting-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting" title="Permalink"></a></h2><p>FlexiChains contains a few recipes for plotting with StatsPlots.jl; please see <a href="../plotting/">the Plotting page</a> for full details.</p><p>When plotting a <code>VNChain</code>, array-valued parameters will automatically be split up into their individual components. In this example we plot only <code>tau</code> and <code>theta[1]</code> to save space, but if you were to plot <code>theta</code>, you would get eight separate plots for each element of <code>theta</code>.</p><pre><code class="language-julia hljs">using StatsPlots

# Or omit the second argument to plot all parameters.
plot(chain, [@varname(tau), @varname(theta[1])])</code></pre><p><img src="../plot_ex.svg" alt="Trace and density plots for mu, tau, and theta1"/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Overview</a><a class="docs-footer-nextpage" href="../summarising/">Summarising »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.15.0 on <span class="colophon-date" title="Wednesday 22 October 2025 14:47">Wednesday 22 October 2025</span>. Using Julia version 1.12.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
