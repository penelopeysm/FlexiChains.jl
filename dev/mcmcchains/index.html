<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Migrating from MCMCChains.jl · FlexiChains.jl</title><meta name="title" content="Migrating from MCMCChains.jl · FlexiChains.jl"/><meta property="og:title" content="Migrating from MCMCChains.jl · FlexiChains.jl"/><meta property="twitter:title" content="Migrating from MCMCChains.jl · FlexiChains.jl"/><meta name="description" content="Documentation for FlexiChains.jl."/><meta property="og:description" content="Documentation for FlexiChains.jl."/><meta property="twitter:description" content="Documentation for FlexiChains.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">FlexiChains.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Overview</a></li><li><a class="tocitem" href="../data_structure/">Core data structure</a></li><li class="is-active"><a class="tocitem" href>Migrating from MCMCChains.jl</a><ul class="internal"><li><a class="tocitem" href="#The-fundamental-difference"><span>The fundamental difference</span></a></li><li><a class="tocitem" href="#Accessing-vector-valued-parameters"><span>Accessing vector-valued parameters</span></a></li><li><a class="tocitem" href="#Accessing-individual-elements"><span>Accessing individual elements</span></a></li><li><a class="tocitem" href="#Accessing-&#39;generated-quantities&#39;-(using-:)"><span>Accessing &#39;generated quantities&#39; (using <code>:=</code>)</span></a></li><li><a class="tocitem" href="#No-need-to-avoid-reserved-names"><span>No need to avoid reserved names</span></a></li><li><a class="tocitem" href="#For-DynamicPPL-developers"><span>For DynamicPPL developers</span></a></li><li><a class="tocitem" href="#Design-goals"><span>Design goals</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Migrating from MCMCChains.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Migrating from MCMCChains.jl</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/penelopeysm/FlexiChains.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/penelopeysm/FlexiChains.jl/blob/main/docs/src/mcmcchains.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Migrating-from-MCMCChains.jl"><a class="docs-heading-anchor" href="#Migrating-from-MCMCChains.jl">Migrating from MCMCChains.jl</a><a id="Migrating-from-MCMCChains.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Migrating-from-MCMCChains.jl" title="Permalink"></a></h1><p>FlexiChains.jl has been designed from the ground up to address existing limitations of <a href="https://github.com/TuringLang/MCMCChains.jl">MCMCChains.jl</a>.</p><p>This page describes some key differences from MCMCChains.jl and how you can migrate your code to use FlexiChains.jl.</p><h2 id="The-fundamental-difference"><a class="docs-heading-anchor" href="#The-fundamental-difference">The fundamental difference</a><a id="The-fundamental-difference-1"></a><a class="docs-heading-anchor-permalink" href="#The-fundamental-difference" title="Permalink"></a></h2><p>Under the hood, MCMCChains.jl uses <a href="https://github.com/JuliaArrays/AxisArrays.jl/"><code>AxisArrays.AxisArray</code></a> as its data structure. Specifically, this allows it to store data in a compact 3-dimensional matrix, and index into the matrix using <code>Symbol</code>s.</p><p>The downside of this is that it enforces a key type of <code>Symbol</code> and a value type of <code>Tval&lt;:Real</code>. This means that, for example, if you have a model with vector-valued parameters (like <code>x</code> above), the vectors will be split up into their individual elements before being stored in the chain.</p><p>This is <em>the</em> core of how MCMCChains and FlexiChains differ, and all of the behaviour shown below stems from this.</p><p>To illustrate this, let&#39;s sample from a typical Turing model and store the results in both <code>MCMCChains.Chains</code> and <code>FlexiChains.FlexiChain</code>.</p><pre><code class="language-julia hljs"># using Turing, MCMCChains, FlexiChains, Random
# 
# @model function f(x)
#     chol ~ LKJCholesky(3, 1.0)
#     corr := PDMats.PDMat(chol)
#     mu ~ MvNormal(zeros(3), I)
#     x ~ MvNormal(mu, corr)
# end
#
# model = f(randn(Xoshiro(468), 3))
# mcmc = sample(Xoshiro(468), model, NUTS(), 100; chain_type=MCMCChains.Chains)
# flexi = sample(Xoshiro(468), model, NUTS(), 100; chain_type=FlexiChains.FlexiChain)</code></pre><h2 id="Accessing-vector-valued-parameters"><a class="docs-heading-anchor" href="#Accessing-vector-valued-parameters">Accessing vector-valued parameters</a><a id="Accessing-vector-valued-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Accessing-vector-valued-parameters" title="Permalink"></a></h2><p>Blah</p><h2 id="Accessing-individual-elements"><a class="docs-heading-anchor" href="#Accessing-individual-elements">Accessing individual elements</a><a id="Accessing-individual-elements-1"></a><a class="docs-heading-anchor-permalink" href="#Accessing-individual-elements" title="Permalink"></a></h2><p>Blah</p><h2 id="Accessing-&#39;generated-quantities&#39;-(using-:)"><a class="docs-heading-anchor" href="#Accessing-&#39;generated-quantities&#39;-(using-:)">Accessing &#39;generated quantities&#39; (using <code>:=</code>)</a><a id="Accessing-&#39;generated-quantities&#39;-(using-:)-1"></a><a class="docs-heading-anchor-permalink" href="#Accessing-&#39;generated-quantities&#39;-(using-:)" title="Permalink"></a></h2><p>Blah</p><h2 id="No-need-to-avoid-reserved-names"><a class="docs-heading-anchor" href="#No-need-to-avoid-reserved-names">No need to avoid reserved names</a><a id="No-need-to-avoid-reserved-names-1"></a><a class="docs-heading-anchor-permalink" href="#No-need-to-avoid-reserved-names" title="Permalink"></a></h2><p>When sampling from a Turing model with MCMCChains as the output format, some metadata (non-parameter keys) such as <code>lp</code> are added to the chain. If your model contains a variable called <code>lp</code>, sampling will still work but <a href="https://github.com/TuringLang/MCMCChains.jl/issues/469">odd things will happen</a>. HMC samplers further include extra metadata such as <code>hamiltonian_energy</code>, and in general <strong>any sampler</strong> can include any kind of extra metadata it wants. As a user, you have no way of knowing what these names are, and you have to avoid using them in your model, which is quite unfair.</p><p>(demo)</p><p>FlexiChains circumvents this entirely since it stores these separately as <code>Parameter(@varname(lp))</code> and <code>OtherKey(:stats, :lp)</code>. Again, you will run into ambiguities if you simply attempt to index the chain with <code>[:lp]</code>:</p><p>(demo)</p><p>but you can still access the value using the original <code>Parameter</code>:</p><p>(demo)</p><p>and this difference is also respected when pretty-printing the chain (MCMCChains simply hides the <code>lp</code> parameter from you because it thinks that it&#39;s an internal name).</p><h2 id="For-DynamicPPL-developers"><a class="docs-heading-anchor" href="#For-DynamicPPL-developers">For DynamicPPL developers</a><a id="For-DynamicPPL-developers-1"></a><a class="docs-heading-anchor-permalink" href="#For-DynamicPPL-developers" title="Permalink"></a></h2><p>Blah</p><h2 id="Design-goals"><a class="docs-heading-anchor" href="#Design-goals">Design goals</a><a id="Design-goals-1"></a><a class="docs-heading-anchor-permalink" href="#Design-goals" title="Permalink"></a></h2><p>My main design goals for FlexiChains.jl were twofold:</p><ol><li><p>To provide a rich data structure that can more faithfully represent the outputs from sampling with Turing.jl.</p><p>The restriction of MCMCChains.jl to <code>Symbol</code> keys and <code>Real</code> values means that round-trip conversion is a lossy operation. Consider, e.g., the <code>predict(::Model, ::MCMCChains.Chains)</code> function, which is used to sample from the posterior predictive distribution. This requires one to extract the values from the chain and insert them back into the model (or technically the <code>VarInfo</code>).</p><p>However, in general one cannot reconstruct a vector <code>x</code> from its constituent elements <code>x[1]</code>, <code>x[2]</code>, ... as we do not know the appropriate length of the vector! The current implementation of this function in DynamicPPL.jl thus has to, essentially, insert all the elements it can find and hope for the best.</p><p>Essentially, MCMCChains&#39; data structure forces packages like Turing.jl and DynamicPPL.jl to include workarounds to deal with the limitations of the chains package.</p></li><li><p>To create a robust and readable codebase.</p><p>Much Julia code is written with the intention of efficiency or versatility, often sacrificing clarity in the process. This is usually acceptable when creating simple scripts. However, I believe that library code should be held to a (much) higher standard.</p><p>In particular, I consider the overuse of multiple dispatch to be a major source of confusion in Julia code. Types cannot be fully inferred at compile time (and even when they can, it requires packages such as JET.jl, which do not (yet) have convenient language server integrations). This means that when reading code, one cannot easily determine which method is being called.</p><p>A prime example is the <code>Chains</code> constructor in MCMCChains.jl. <code>methods(Chains)</code> returns 11 methods, and each time you see a call to <code>Chains(...)</code> you need to figure out which of these 11 it is. In writing FlexiChains I have made a conscious choice to create only two inner constructors for <code>FlexiChain</code>.</p></li></ol><p>In particular, notice that <em>performance</em> is not one of my considerations. In my opinion, performance is only a minor concern for FlexiChains.jl, because the main bottleneck in Bayesian inference is the sampling, not how fast one can construct or index into a chain. I have not performed any benchmarks but I would expect that most operations on <code>MCMCChains.Chains</code> will be faster than on <code>FlexiChains.FlexiChain</code>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../data_structure/">« Core data structure</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Sunday 27 July 2025 02:37">Sunday 27 July 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
