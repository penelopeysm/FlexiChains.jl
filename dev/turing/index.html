<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Usage with Turing.jl · FlexiChains.jl</title><meta name="title" content="Usage with Turing.jl · FlexiChains.jl"/><meta property="og:title" content="Usage with Turing.jl · FlexiChains.jl"/><meta property="twitter:title" content="Usage with Turing.jl · FlexiChains.jl"/><meta name="description" content="Documentation for FlexiChains.jl."/><meta property="og:description" content="Documentation for FlexiChains.jl."/><meta property="twitter:description" content="Documentation for FlexiChains.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">FlexiChains.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Overview</a></li><li class="is-active"><a class="tocitem" href>Usage with Turing.jl</a><ul class="internal"><li><a class="tocitem" href="#Sampling"><span>Sampling</span></a></li><li><a class="tocitem" href="#Accessing-data"><span>Accessing data</span></a></li><li><a class="tocitem" href="#Saving-and-resuming-MCMC-sampling-progress"><span>Saving and resuming MCMC sampling progress</span></a></li><li><a class="tocitem" href="#Posterior-predictions-and-friends"><span>Posterior predictions and friends</span></a></li><li><a class="tocitem" href="#Statistics-and-plotting"><span>Statistics and plotting</span></a></li></ul></li><li><a class="tocitem" href="../details/">FlexiChains in more detail</a></li><li><a class="tocitem" href="../whynew/">Why a new package?</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Usage with Turing.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Usage with Turing.jl</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/penelopeysm/FlexiChains.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/penelopeysm/FlexiChains.jl/blob/main/docs/src/turing.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Usage-with-Turing.jl"><a class="docs-heading-anchor" href="#Usage-with-Turing.jl">Usage with Turing.jl</a><a id="Usage-with-Turing.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Usage-with-Turing.jl" title="Permalink"></a></h1><p>This page describes how to use FlexiChains from the perspective of a Turing.jl user.</p><p>In particular, it does not explain &#39;under the hood&#39; how FlexiChains works. Rather, it focuses on the usage of FlexiChains within a typical Bayesian inference workflow. For more detailed information about the inner workings of FlexiChains, please see <a href="../details/">the next page</a>.</p><h2 id="Sampling"><a class="docs-heading-anchor" href="#Sampling">Sampling</a><a id="Sampling-1"></a><a class="docs-heading-anchor-permalink" href="#Sampling" title="Permalink"></a></h2><p>To obtain a <code>FlexiChain</code> from Turing.jl, you will need to specify a <code>chain_type</code> of <code>FlexiChains.VNChain</code> when performing MCMC sampling.</p><p>Let&#39;s use a non-trivial model so that we can illustrate some features of FlexiChains.</p><pre><code class="language-julia hljs">using Turing
using FlexiChains: VNChain

y = [28, 8, -3, 7, -1, 1, 18, 12]
sigma = [15, 10, 16, 11, 9, 11, 10, 18]
@model function eight_schools(y, sigma)
    mu ~ Normal(0, 5)
    tau ~ truncated(Cauchy(0, 5); lower=0)
    theta ~ MvNormal(fill(mu, length(y)), tau^2 * I)
    for i in eachindex(y)
        y[i] ~ Normal(theta[i], sigma[i])
    end
    return (mu=mu, tau=tau)
end
model = eight_schools(y, sigma)
chain = sample(model, NUTS(), 5; chain_type=VNChain)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr1">FlexiChain (5 iterations, 1 chain)</span>

<span class="sgr1">Parameter type   </span>VarName
<span class="sgr1">Parameters       </span>theta, tau, mu
<span class="sgr1">Other keys       </span>{:logprobs} loglikelihood, lp, logprior
                 {:sampler_stats} hamiltonian_energy, n_steps, numerical_error, max_hamiltonian_energy_error, step_size, acceptance_rate, hamiltonian_energy_error, is_accept, tree_depth, log_density, nom_step_size</code></pre><div class="admonition is-info" id="Note-c58b79a61802d46a"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-c58b79a61802d46a" title="Permalink"></a></header><div class="admonition-body"><p>We only run 5 MCMC iterations here to keep the output in the following sections small.</p></div></div><h2 id="Accessing-data"><a class="docs-heading-anchor" href="#Accessing-data">Accessing data</a><a id="Accessing-data-1"></a><a class="docs-heading-anchor-permalink" href="#Accessing-data" title="Permalink"></a></h2><p>First, notice in the printout above that a <code>FlexiChain</code> stores parameters and &#39;other keys&#39; separately. The way to access these differs slightly.</p><h3 id="Parameters"><a class="docs-heading-anchor" href="#Parameters">Parameters</a><a id="Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Parameters" title="Permalink"></a></h3><p>To access parameters, the <em>most correct</em> way is to use <code>VarName</code>s to index into the chain. <code>VarName</code> is a data structure <a href="https://turinglang.org/AbstractPPL.jl/stable/api/#AbstractPPL.VarName">defined in AbstractPPL.jl</a>, and is what Turing.jl uses to represent the name of a random variable (appearing on the left-hand side of a tilde-statement).</p><p>For example, this directly gives us the value of <code>mu</code> in each iteration as a plain old vector of floats.</p><pre><code class="language-julia hljs">chain[@varname(mu)]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5-element Vector{Float64}:
 11.368020927839995
 11.987645669065653
 11.987645669065653
 11.248172631209847
 11.248172631209847</code></pre><div class="admonition is-info" id="Multiple-chains-962db0141df798d1"><header class="admonition-header">Multiple chains<a class="admonition-anchor" href="#Multiple-chains-962db0141df798d1" title="Permalink"></a></header><div class="admonition-body"><p>If you sample multiple chains, e.g. with <code>sample(model, NUTS(), MCMCThreads(), 1000, 3; chain_type=VNChain)</code>, then indexing into the <code>FlexiChain</code> will give you a matrix of floats instead.</p></div></div><p>For vector-valued parameters like <code>theta</code>, this works in exactly the same way, except that you get a vector of vectors (note: not a matrix).</p><pre><code class="language-julia hljs">chain[@varname(theta)]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5-element Vector{Vector{Float64}}:
 [11.874469510905353, 12.13191448183063, 12.283953549270013, 12.088730229464275, 13.667127052153337, 10.160441184711791, 9.87908113121566, 12.724824948460562]
 [11.794754697446704, 11.902367797240425, 11.196931067570704, 13.424381904900885, 13.70816561502093, 11.342416406797401, 9.969943425620928, 13.17234588019867]
 [11.794754697446704, 11.902367797240425, 11.196931067570704, 13.424381904900885, 13.70816561502093, 11.342416406797401, 9.969943425620928, 13.17234588019867]
 [11.82779178894798, 13.674115267169054, 12.210330036068225, 11.880710596914973, 14.65187811628122, 12.443748929775824, 9.952524252289818, 12.211326847534647]
 [11.82779178894798, 13.674115267169054, 12.210330036068225, 11.880710596914973, 14.65187811628122, 12.443748929775824, 9.952524252289818, 12.211326847534647]</code></pre><p>This is probably the most major difference between FlexiChains and MCMCChains. MCMCChains by default will break vector-valued parameters into multiple scalar-valued parameters called <code>theta[1]</code>, <code>theta[2]</code>, etc., whereas FlexiChains keeps them together as they were defined in the model.</p><p>If you want to obtain the first element of <code>theta</code>, you can index into it with the corresponding <code>VarName</code>:</p><pre><code class="language-julia hljs">chain[@varname(theta[1])]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5-element Vector{Float64}:
 11.874469510905353
 11.794754697446704
 11.794754697446704
 11.82779178894798
 11.82779178894798</code></pre><p>Note that this can only be used to &#39;break down&#39;, or access nested fields of, larger parameters. That is, if your model has <code>x ~ dist</code>, FlexiChains will let you access some field or index of <code>x</code>.</p><p>However, you cannot go the other way: if your model has <code>x[1] ~ dist</code> you cannot &#39;reconstruct&#39; <code>x</code> from its component elements. (Or at least, you can&#39;t do it with FlexiChains. You can still call <code>chain[@varname(x[1])]</code> and <code>chain[@varname(x[2])]</code> and then perform <code>hcat</code> or similar to put them together yourself.)</p><h3 id="Other-information-in-the-chain"><a class="docs-heading-anchor" href="#Other-information-in-the-chain">Other information in the chain</a><a id="Other-information-in-the-chain-1"></a><a class="docs-heading-anchor-permalink" href="#Other-information-in-the-chain" title="Permalink"></a></h3><p>In general Turing.jl tries to package up some extra metadata into the chain that may be helpful. For example, the log-joint probability of each sample is stored with the key <code>:lp</code>. Notice in the <code>FlexiChain</code> output displayed above, this is associated with a <em>section</em>, labelled <code>:logprobs</code>. In <code>FlexiChain</code>s, all non-parameter keys are grouped into <em>sections</em>.</p><p>To access these, you need to specify both the section name and the key name.</p><pre><code class="language-julia hljs">chain[:logprobs, :lp]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5-element Vector{Float64}:
 -51.43394157395119
 -51.55097257632744
 -51.55097257632744
 -53.90951921181552
 -53.90951921181552</code></pre><h3 id="Shortcuts"><a class="docs-heading-anchor" href="#Shortcuts">Shortcuts</a><a id="Shortcuts-1"></a><a class="docs-heading-anchor-permalink" href="#Shortcuts" title="Permalink"></a></h3><p>If you are used to MCMCChains.jl, you may find this more cumbersome than before. So, FlexiChains provides some shortcuts for accessing data. You can index into a <code>FlexiChain</code> with a single <code>Symbol</code>, and <em>as long as it is unambiguous</em>, it will return the corresponding data.</p><pre><code class="language-julia hljs">chain[:mu] # parameter</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5-element Vector{Float64}:
 11.368020927839995
 11.987645669065653
 11.987645669065653
 11.248172631209847
 11.248172631209847</code></pre><div class="admonition is-info" id="What-does-unambiguous-mean?-e1bb5f27dc692bac"><header class="admonition-header">What does unambiguous mean?<a class="admonition-anchor" href="#What-does-unambiguous-mean?-e1bb5f27dc692bac" title="Permalink"></a></header><div class="admonition-body"><p>In this case, because the only parameter <code>p</code> for which <code>Symbol(p) == :mu</code> is <code>@varname(mu)</code>, we can safely identify <code>@varname(mu)</code> as the parameter that we want.</p></div></div><p>Likewise, we can omit the section symbol for the <code>:lp</code> data.</p><pre><code class="language-julia hljs">chain[:lp] # other key</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5-element Vector{Float64}:
 -51.43394157395119
 -51.55097257632744
 -51.55097257632744
 -53.90951921181552
 -53.90951921181552</code></pre><p>If there is any ambiguity present (for example if there is a parameter named <code>lp</code> as well), FlexiChains will throw an error.</p><h2 id="Saving-and-resuming-MCMC-sampling-progress"><a class="docs-heading-anchor" href="#Saving-and-resuming-MCMC-sampling-progress">Saving and resuming MCMC sampling progress</a><a id="Saving-and-resuming-MCMC-sampling-progress-1"></a><a class="docs-heading-anchor-permalink" href="#Saving-and-resuming-MCMC-sampling-progress" title="Permalink"></a></h2><p>If you want to sample a fewer number of iterations first and then resume it later, you can use the following:</p><pre><code class="language-julia hljs">chn1 = sample(model, NUTS(), 10; chain_type=VNChain, save_state=true)
chn2 = sample(model, NUTS(), 10; chain_type=VNChain, resume_from=chn1)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr1">FlexiChain (10 iterations, 1 chain)</span>

<span class="sgr1">Parameter type   </span>VarName
<span class="sgr1">Parameters       </span>theta, tau, mu
<span class="sgr1">Other keys       </span>{:logprobs} loglikelihood, lp, logprior
                 {:sampler_stats} hamiltonian_energy, n_steps, numerical_error, max_hamiltonian_energy_error, step_size, acceptance_rate, hamiltonian_energy_error, is_accept, tree_depth, log_density, nom_step_size</code></pre><p>The chains can be combined using <code>vcat</code>:</p><pre><code class="language-julia hljs">chn = vcat(chn1, chn2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr1">FlexiChain (20 iterations, 1 chain)</span>

<span class="sgr1">Parameter type   </span>VarName
<span class="sgr1">Parameters       </span>theta, tau, mu
<span class="sgr1">Other keys       </span>{:logprobs} loglikelihood, lp, logprior
                 {:sampler_stats} hamiltonian_energy, n_steps, numerical_error, max_hamiltonian_energy_error, step_size, acceptance_rate, hamiltonian_energy_error, is_accept, tree_depth, log_density, nom_step_size</code></pre><div class="admonition is-info" id="Multiple-chain-sampling-194247fe82e371b1"><header class="admonition-header">Multiple-chain sampling<a class="admonition-anchor" href="#Multiple-chain-sampling-194247fe82e371b1" title="Permalink"></a></header><div class="admonition-body"><p>In general, the <code>resume_from</code> argument only works automatically if both the original and resumed sampling use the same number of chains. That is, <code>chn1</code> and <code>chn2</code> must either both be invoked as <code>sample(model, spl, N)</code>, or both invoked as <code>sample(model, spl, MCMCThreads(), N, C)</code> with the same <code>C</code>.</p><p>If you need more flexibility than this, then the <code>initial_state</code> keyword argument is recommended instead. When performing single-chain sampling with <code>sample(model, spl, N; initial_state=state)</code>, <code>initial_state</code> should be either <code>nothing</code> (to start a new chain) or the state to resume from. For parallel sampling with <code>sample(model, spl, MCMCThreads(), N, C)</code>, <code>initial_state</code> should be a vector of length <code>C</code>, where <code>initial_state[i]</code> is the state to resume the <code>i</code>-th chain from (or <code>nothing</code> to start a new chain).</p><p>To obtain the saved final state of a chain, you can use <a href="../details/#FlexiChains.last_sampler_state"><code>FlexiChains.last_sampler_state</code></a>. This is either a single state (for single-chain sampling) or a vector of states (for multi-chain sampling).</p><p>The above applies equally to <code>MCMCSerial()</code> and <code>MCMCDistributed()</code>.</p></div></div><h2 id="Posterior-predictions-and-friends"><a class="docs-heading-anchor" href="#Posterior-predictions-and-friends">Posterior predictions and friends</a><a id="Posterior-predictions-and-friends-1"></a><a class="docs-heading-anchor-permalink" href="#Posterior-predictions-and-friends" title="Permalink"></a></h2><p>The functions <code>predict</code>, <code>returned</code>, <code>logjoint</code>, <code>loglikelihood</code>, and <code>logprior</code> all work &#39;as expected&#39; using FlexiChains with exactly the same signatures that you are used to. Please consult <a href="https://turinglang.org/Turing.jl/stable/api/#Predictions">the Turing.jl documentation</a> for more details.</p><pre><code class="language-julia hljs">returned(model, chain)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5-element Vector{@NamedTuple{mu::Float64, tau::Float64}}:
 (mu = 11.368020927839995, tau = 1.5787162156124512)
 (mu = 11.987645669065653, tau = 1.5864581486249616)
 (mu = 11.987645669065653, tau = 1.5864581486249616)
 (mu = 11.248172631209847, tau = 1.8661234030292053)
 (mu = 11.248172631209847, tau = 1.8661234030292053)</code></pre><p>The <code>pointwise_logdensity</code> family of functions is not yet implemented.</p><h2 id="Statistics-and-plotting"><a class="docs-heading-anchor" href="#Statistics-and-plotting">Statistics and plotting</a><a id="Statistics-and-plotting-1"></a><a class="docs-heading-anchor-permalink" href="#Statistics-and-plotting" title="Permalink"></a></h2><p>Right now FlexiChains does not (yet) provide any functionality for calculating statistics or plotting, although these are planned for the future.</p><p>In the meantime, you can convert a <code>FlexiChain</code> to an <code>MCMCChains.Chains</code> object using the <code>MCMCChains.Chains</code> constructor.</p><pre><code class="language-julia hljs">using MCMCChains
mcmc = MCMCChains.Chains(chain)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Chains MCMC chain (5×24×1 Array{Float64, 3}):

Iterations        = 1:1:5
Number of chains  = 1
Samples per chain = 5
parameters        = mu, tau, theta[1], theta[2], theta[3], theta[4], theta[5], theta[6], theta[7], theta[8]
internals         = nom_step_size, acceptance_rate, hamiltonian_energy, hamiltonian_energy_error, loglikelihood, lp, step_size, max_hamiltonian_energy_error, n_steps, numerical_error, tree_depth, logprior, log_density, is_accept

Use `describe(chains)` for summary statistics and quantiles.
</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Overview</a><a class="docs-footer-nextpage" href="../details/">FlexiChains in more detail »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Wednesday 10 September 2025 12:21">Wednesday 10 September 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
